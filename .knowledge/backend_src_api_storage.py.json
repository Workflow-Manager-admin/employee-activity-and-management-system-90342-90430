{"is_source_file": true, "format": "Python", "description": "This Python source file defines a class 'JSONStorage' that manages persistent, thread-safe storage of employee, work log, leave request, feedback, audit trail, and system settings data using JSON files. It includes methods for creating, reading, updating, and deleting records, along with utility functions for file locking, JSON serialization, password hashing, and user authentication.", "external_files": [".models"], "external_methods": ["fcntl.flock", "hashlib.sha256", "uuid.uuid4", "json.dump", "json.loads", "datetime.now", "datetime.fromisoformat", "Path.exists", "Path.mkdir", "Path.replace", "Path.unlink"], "published": ["storage"], "classes": [{"name": "JSONStorage", "description": "A thread-safe storage manager handling CRUD operations for various employee management-related entities using JSON files with concurrency control."}], "methods": [{"name": "__init__(self, data_dir: str = \"data\")", "description": "Initializes data directory and JSON files, creating empty files if they do not exist.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "_file_lock(self, file_path: Path)", "description": "Context manager to lock a given file during operations to ensure thread safety.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List[Dict[str,Any]] _read_json_file(self, file_path: Path)", "description": "Reads JSON data from a file with error handling and safety.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "_write_json_file(self, file_path: Path, data: List[Dict[str, Any]])", "description": "Writes JSON data to a file atomically.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "_json_serializer(self, obj)", "description": "Custom serializer for datetime and date objects to JSON.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "str _generate_id(self)", "description": "Generates a unique identifier using UUID4.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "str _hash_password(self, password: str)", "description": "Hashes a password string using SHA-256.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "bool _verify_password(self, password: str, hashed: str)", "description": "Verifies a plaintext password against a hash.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "dict create_employee(self, employee_data)", "description": "Creates a new employee record, ensuring email uniqueness.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "get_employee(self, employee_id: str)", "description": "Retrieves an employee by ID.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "get_employee_by_email(self, email: str)", "description": "Retrieves an employee by email.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List get_all_employees(self)", "description": "Returns a list of all employee records.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "update_employee(self, employee_id: str, updates: dict)", "description": "Updates an existing employee's data.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "bool delete_employee(self, employee_id: str)", "description": "Marks an employee as inactive.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "dict create_work_log(self, employee_id: str, log_data)", "description": "Creates a new work log entry for an employee.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "get_work_log(self, log_id: str)", "description": "Retrieves a work log by ID.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List get_work_logs_by_employee(self, employee_id: str, start_date: Optional[date] = None, end_date: Optional[date] = None)", "description": "Retrieves work logs for an employee, optionally filtered by date range.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "update_work_log(self, log_id: str, updates: dict)", "description": "Updates a work log entry.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "dict create_leave_request(self, employee_id: str, leave_data)", "description": "Creates a new leave request for an employee.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "get_leave_request(self, request_id: str)", "description": "Retrieves a leave request by ID.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List get_leave_requests_by_employee(self, employee_id: str)", "description": "Retrieves leave requests for an employee.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List get_leave_requests_by_manager(self, manager_id: str)", "description": "Retrieves leave requests pending approval for a manager.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "update_leave_request(self, request_id: str, updates: dict)", "description": "Updates a leave request.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "dict create_feedback(self, manager_id: str, feedback_data)", "description": "Creates feedback for a work log.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "dict create_audit_entry(self, user_id: str, action: str, resource_type: str, resource_id: str, details: dict, ip_address: Optional[str] = None, user_agent: Optional[str] = None)", "description": "Creates an audit trail record.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "List get_audit_trails(self, limit: int = 100)", "description": "Retrieves recent audit trail entries.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "get_settings(self)", "description": "Fetches system settings, creating default if not existing.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "update_settings(self, updates: dict)", "description": "Updates system settings.", "scope": "JSONStorage", "scopeKind": "class"}, {"name": "authenticate_user(self, email: str, password: str)", "description": "Authenticates a user by email and password.", "scope": "JSONStorage", "scopeKind": "class"}], "calls": ["fcntl.flock", "hashlib.sha256", "uuid.uuid4", "json.dump", "json.loads", "datetime.now", "datetime.fromisoformat", "Path.exists", "Path.mkdir", "Path.replace", "Path.unlink"], "search-terms": ["JSONStorage", "thread-safe JSON file management", "employee record", "work logs", "leave requests", "feedback", "audit trail", "atomic JSON write", "file locking", "password hashing", "user authentication"], "state": 2, "file_id": 7, "knowledge_revision": 41, "git_revision": "", "revision_history": [{"15": ""}, {"33": ""}, {"39": ""}, {"40": ""}, {"41": ""}], "ctags": [{"_type": "tag", "name": "JSONStorage", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^class JSONStorage:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "T", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^T = TypeVar('T')$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def __init__(self, data_dir: str = \"data\"):$/", "language": "Python", "kind": "member", "signature": "(self, data_dir: str = \"data\")", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_file_lock", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _file_lock(self, file_path: Path):$/", "language": "Python", "kind": "member", "signature": "(self, file_path: Path)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_generate_id", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _generate_id(self) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_hash_password", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _hash_password(self, password: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, password: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_json_serializer", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _json_serializer(self, obj):$/", "language": "Python", "kind": "member", "signature": "(self, obj)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_read_json_file", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _read_json_file(self, file_path: Path) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "member", "signature": "(self, file_path: Path)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_verify_password", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _verify_password(self, password: str, hashed: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "member", "signature": "(self, password: str, hashed: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "_write_json_file", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def _write_json_file(self, file_path: Path, data: List[Dict[str, Any]]):$/", "language": "Python", "kind": "member", "signature": "(self, file_path: Path, data: List[Dict[str, Any]])", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "authenticate_user", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def authenticate_user(self, email: str, password: str):$/", "language": "Python", "kind": "member", "signature": "(self, email: str, password: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "create_audit_entry", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def create_audit_entry(self, user_id: str, action: str, resource_type: str, $/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, user_id: str, action: str, resource_type: str, resource_id: str, details: dict, ip_address: Optional[str] = None, user_agent: Optional[str] = None)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "create_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def create_employee(self, employee_data) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, employee_data)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "create_feedback", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def create_feedback(self, manager_id: str, feedback_data) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, manager_id: str, feedback_data)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "create_leave_request", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def create_leave_request(self, employee_id: str, leave_data) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, employee_id: str, leave_data)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "create_work_log", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def create_work_log(self, employee_id: str, log_data) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, employee_id: str, log_data)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "delete_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def delete_employee(self, employee_id: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "member", "signature": "(self, employee_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_all_employees", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_all_employees(self) -> List:$/", "language": "Python", "typeref": "typename:List", "kind": "member", "signature": "(self)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_audit_trails", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_audit_trails(self, limit: int = 100) -> List:$/", "language": "Python", "typeref": "typename:List", "kind": "member", "signature": "(self, limit: int = 100)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_employee(self, employee_id: str):$/", "language": "Python", "kind": "member", "signature": "(self, employee_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_employee_by_email", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_employee_by_email(self, email: str):$/", "language": "Python", "kind": "member", "signature": "(self, email: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_leave_request", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_leave_request(self, request_id: str):$/", "language": "Python", "kind": "member", "signature": "(self, request_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_leave_requests_by_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_leave_requests_by_employee(self, employee_id: str) -> List:$/", "language": "Python", "typeref": "typename:List", "kind": "member", "signature": "(self, employee_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_leave_requests_by_manager", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_leave_requests_by_manager(self, manager_id: str) -> List:$/", "language": "Python", "typeref": "typename:List", "kind": "member", "signature": "(self, manager_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_settings", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_settings(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_work_log", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_work_log(self, log_id: str):$/", "language": "Python", "kind": "member", "signature": "(self, log_id: str)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "get_work_logs_by_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def get_work_logs_by_employee(self, employee_id: str, start_date: Optional[date] = None, end/", "language": "Python", "typeref": "typename:List", "kind": "member", "signature": "(self, employee_id: str, start_date: Optional[date] = None, end_date: Optional[date] = None)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "storage", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^storage = JSONStorage()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_employee", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def update_employee(self, employee_id: str, updates: dict):$/", "language": "Python", "kind": "member", "signature": "(self, employee_id: str, updates: dict)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "update_leave_request", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def update_leave_request(self, request_id: str, updates: dict):$/", "language": "Python", "kind": "member", "signature": "(self, request_id: str, updates: dict)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "update_settings", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def update_settings(self, updates: dict):$/", "language": "Python", "kind": "member", "signature": "(self, updates: dict)", "scope": "JSONStorage", "scopeKind": "class"}, {"_type": "tag", "name": "update_work_log", "path": "/home/kavia/workspace/code-generation/employee-activity-and-management-system-90342-90430/backend/src/api/storage.py", "pattern": "/^    def update_work_log(self, log_id: str, updates: dict):$/", "language": "Python", "kind": "member", "signature": "(self, log_id: str, updates: dict)", "scope": "JSONStorage", "scopeKind": "class"}], "hash": "51a53a1e7fce3db79a91f23be0ff1eb6", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/storage.py", "fields": [{"name": "T = TypeVar('T')", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "storage = JSONStorage()", "scope": "", "scopeKind": "", "description": "unavailable"}]}